/*--------------------------------------------*\
				xgjd members-pic js
   		   Design And Build By Owen
      Github:http://github.com/numerhero

\*--------------------------------------------*/


/* 对应文件夹名 22 */ 
var oMembersInfo = [
	{
		"name" : "AllenYang", 
		"duties" : "2014基地总负责人",
		"introduction" : "介绍",
		"joinJdTime" : "2014-3-5",
		"luckColor" : "#51b9c5",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/AllenYang/AllenYang.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"joinJdTime" : "2014-3-5",
		"luckColor" : "#23527c",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Snow",
		"duties" : "前端组成员",
		"introduction" : "个人爱好：听音乐，读书，看电影，运动",
		"joinJdTime" : "2014-3-5",
		"luckColor" : "#AAF5F5",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Snow/Snow.png";
			return img;
		}())
	},{
		"name" : "YanLong",
		"duties" : "Web组成员",
		"introduction" : "喜欢研究新技术",
		"joinJdTime" : "2014-3-5",
		"luckColor" : "#5dccdd",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/YanLong/YanLong.png";
			return img;
		}())
	},{
		"name" : "Niklaus",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"joinJdTime" : "2014-3-5",
		"luckColor" : "#8e95af",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Niklaus/Niklaus.png";
			return img;
		}())
	},{
		"name" : "lianghongchao",
		"duties" : "安卓组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/lianghongchao/lianghongchao.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	},{
		"name" : "Owen",
		"duties" : "前端组成员",
		"introduction" : "喜欢研究新技术",
		"Pic" : (function() {
			var img = new Image();
			img.src = "/assets/img/members-pic/members-pics/Owen/Owen.png";
			return img;
		}())
	}];


iNow      = 0;
/* 图片选择列表加载 */
$(function () {
	var oMembersPicsList = $("#members-pics-list");
	var oShowPic  = $("#show-pic");
	var oBHeight = 30;
	
	// 加载小头像列表
	oMembersPicsList.loadTallPics( oMembersInfo );

	// 加载屏幕效果
	var screenEffect = oShowPic.loadPicInit();
	screenEffect.createFrameWork( oMembersInfo , 630/oBHeight );
	
	// 挂载点击函数
	var oLis = $("#members-pics-list>li");
	oLis.each(function (idx , value) {
		var $self = $(this);
		$self.on("click" , function() {
			screenEffect.clickHandle( oMembersInfo , idx );
		});
	});

});

/* show our youth */ 
$(function () {
	var listStage  = $("#list-stage");
	var oStage = new c.Stage("show-our-youth");

		init();
		function init() {
			var CanvasWidth = listStage.width();
			var CanvasHeight = listStage.height();
			
			var num = 3;
			var f = 120;
			var r = -60;

			oStage.canvas.width = CanvasWidth;
			oStage.canvas.height = CanvasHeight;
			oStage.alpha = 0.7;

			var Shape = new c.Shape();
			function render() {
				var randomY = (random()*0.8 + 0.19).toFixed(1);
				var Point = [
					{ x : 0 , y : CanvasHeight * randomY + f}, 
					{ x : 0 , y : CanvasHeight * randomY - f}
				];
				while( Point[1].x < CanvasWidth + f ) {
					draw( Point );
				}
				oStage.addChild(Shape);
				oStage.update();
			}
			function judge(parameter) {
				var t = parameter + (random()*2 - 0.8) * f;
				return (t > CanvasHeight || t<0 ) ? judge(parameter) : t;
			}
			function draw( Point ) {
				var randomColor = "#" + (Cos(r) * 127 + 128 << 16 | Cos(r + dPI/3) * 127 + 128 <<8 | Cos(r + dPI/3 * 2) * 127 + 128).toString(16);
				Shape.graphics.setStrokeStyle(1).beginFill(randomColor).mt(Point[0].x , Point[0].y)
				.lt(Point[1].x , Point[1].y);

				var p = {};				
				p.x = Point[1].x + (random()*2 - 0.25) * f;
				p.y = judge(Point[1].y);
				Shape.graphics.lt(p.x , p.y);
				Shape.graphics.closePath();

				r -= dPI/-50;

				Point[0] = Point[1];
				Point[1] = p;
			}

			for( var i = 0 ; i<num ;i++ ) {
				render();
			}

			listStage.on("click" , ".members-pics-mask" , function (ev) {
				Shape.graphics.clear();
				oStage.update();
				for( var i = 0 ; i<num ;i++ ) {
					render();
				}	
			});
			$(window).on("resize" , function () {
				CanvasWidth = listStage.width();
				CanvasHeight = listStage.height();
				oStage.canvas.width = CanvasWidth;
				oStage.canvas.height = CanvasHeight;
				Shape.graphics.clear();
				oStage.update();
				for( var i = 0 ; i<num ;i++ ) {
					render();
				}
			});
		}		
})

var picShowStage   = $("#pic-show-stage");
var Con            = $("#con");
var oLi            = $(".con-time-line li");
var branchLine     = $(".con-time-line li .branch-line");
var branchLineNode = $(".con-time-line li .branch-line .branch-line-node")
var branchShewLine = $(".branch-shew-line");
var branchShewLtl  = $(".branch-shew-ltl");
var branchShewLineNode = $(".branch-shew-ltl .branch-shew-line-node");


function renderTree ( obj , shoX ) {
	picShowStage.css("background",obj[shoX]["luckColor"]);
	Con.css("background" , obj[shoX]["luckColor"]);
	oLi.css("background" , obj[shoX]["luckColor"]);
	branchLine.css("background" , obj[shoX]["luckColor"]);
	branchLineNode.css("background" , obj[shoX]["luckColor"]);
	branchShewLine.css("background" , obj[shoX]["luckColor"]);
	branchShewLtl.css("background" , obj[shoX]["luckColor"]);
	branchShewLineNode.css("background" , obj[shoX]["luckColor"]);

}
$.fn.loadPicInit = function () {
	var $self = $(this);
	return ({
		createFrameWork: function ( obj , bnum ) {
			var oTop = $window.scrollTop();
			$.each( obj , function ( idx , value ) {
				var aLi = $('<li></li>').appendTo($self);
				var aDiv = $('<div></div>').appendTo(aLi);
				for( var i = 0 ; i<bnum ; i++ ) {
					var aB = $('<b data-load="false"></b>').appendTo(aDiv);
				}
			});
			this.show( obj , iNow );
		},	
		show: function ( obj , shoX ) {
			renderTree( obj , shoX );
			var oB = $("#show-pic li:eq("+ shoX +") div b");
			oB.each(function (idx , value) {
				var $selfB = $(value);
				var boff   = $selfB.attr("data-load");
				if(!!boff) {
					$selfB.attr("data-load" , "true");
					
					$selfB.css("background", "url("+obj[shoX]["Pic"].src+")");
					$selfB.css("backgroundPosition","0% -"+ idx*0.3 + "rem");
					$selfB.css("transition" , "0.1s "+ idx*0.03 +"s ease-out");	
				}
				setTimeout(function() {	
					$selfB.css("opacity" , "1");
				} , 20);
				iNow = shoX;
			});
		},
		clickHandle: function ( obj , thisIdx ) {
			if(thisIdx === iNow) {
				return;
			};
			this.toPicPos();
			var hidX = iNow;
			iNow = thisIdx;
			var oB = $("#show-pic li:eq("+ hidX +") div b");
			oB.each(function (idx , value) {
				var $selfB = $(value);
				$selfB.css("opacity" , "0");
			});
			this.show( obj , thisIdx );

		},
		toPicPos: function () {
			var speed = 200;
			var pos = $("#pic-show-stage").offset().top;
			$("body,html").animate({ scrollTop : pos },speed);
		},
	});
}

$.fn.loadTallPics = function ( obj ) {	
	var $self = $(this);
	
	return ({
		createFrameWork: function () {
			$.each( obj , function ( idx , value ) {
				var aLi = $('<li><div class="members-pics-mask clear-select"><h1>'+ value["name"] +'</h1><h1>'+ value["duties"] +'</h1></div></li>').appendTo($self);
				aLi.css("background" , "url(/assets/img/members-pic/members-pics/"+ value["name"] +"/"+ value["name"] +"-tall-pic.png) no-repeat")
				aLi.css("backgroundSize" , "cover");
				aLi.css("opacity" , "0");
				if( idx == 10) {
					$('<p id="special" class="clear-select"><span class="str text-stress">基地成员</span> <span class="str text-stress">Members</span></p>').appendTo($self);
				}
			});
			this.show();
		},
		show: function () {
			var oTop = $window.scrollTop();

			if( oTop > $self.offset().top - $self.outerHeight() * 0.2) {
				$window.off("scroll.TallPicsShow" , this.show);
				$("#members-pics-list li").each(function (idx , value) {
					var ValueSelf = $(value);
					ValueSelf.css("transition" , "1s "+ idx*0.05 +"s linear");
					ValueSelf.css("opacity" , "1");
					
					if( idx == 10 ) {
						var oP = $("#special");
						oP.css("transform" , "translateZ(0) scale(1)")
						oP.css("transition" , "1.3s 1s ease-in");
						oP.css("opacity" , "1");
					}
				});		
			}
		},
		init: function () {
			this.createFrameWork();
			$window.on("scroll.TallPicsShow" , this.show);
		}
	}.init());
}


