window.onload=function(){function e(e){for(var t=0;t<e.length;t++){var n=new createjs.Shape,o=5,i=h*d(),r=f*d(),c=m[Math.floor(d()*m.length)];switch(n.id=t,n.alpha=1,n.radius=o,l.floor(2*d())){case 0:n.graphics.beginFill(c).drawCircle(0,0,o);break;case 1:n.graphics.beginStroke(c).drawCircle(0,0,o)}n.x=i,n.y=r,n.originX=e[t].x,n.originY=e[t].y,n.movement="float",a(n),s.addChild(n)}}function t(e){for(var t=0;t<e.length;t++)s.getChildAt(t).movement="in",a(s.getChildAt(t))}function n(e){for(var t=0;t<e.length;t++)s.getChildAt(t).movement="out",a(s.getChildAt(t))}function a(e){switch(e.tween&&e.tween.kill(),e.movement){case"float":e.tween=TweenLite.to(e,5+3.5*d(),{x:e.x+-100+200*d(),y:e.y+-100+200*d(),ease:Quad.easeInOut,alpha:.2+.5*Math.random(),onComplete:function(){a(e)}});break;case"jiggle":e.tween=TweenLite.to(e,.05,{x:e.originX+l.floor(-.5+1*d()),y:e.originY+l.floor(-.5+1*d()),ease:Quad.easeInOut,onComplete:function(){a(e)}});break;case"out":e.tween=TweenLite.to(e,.8,{x:h*d(),y:f*d(),ease:Quad.easeInOut,alpha:.2+.5*Math.random(),scaleX:1,scaleY:1,onComplete:function(){e.movement="float",a(e)}});break;case"in":e.tween=TweenLite.to(e,.8,{x:e.originX,y:e.originY,ease:Quad.easeInOut,scaleX:.8,scaleY:.8,alpha:1,radius:5,onComplete:function(){e.movement="jiggle",a(e)}})}}function o(){var e="联 系 我 们",t=[],n=860/e.length;n>160&&(n=160);var a=new c.Stage("path-text"),o=new c.Text(e,"900 "+n+"px 微软雅黑","#eee");o.textAlign="center",o.x=600,o.y=0,a.addChild(o),a.update();for(var i=document.getElementById("path-text").getContext("2d"),r=i.getImageData(0,0,h,200).data,d=r.length;d>=0;d-=4)if(0!=r[d]){var s=d/4%h,u=l.floor(l.floor(d/4)/h);s&&s%10==0&&u&&u%10==0&&t.push({x:s,y:u})}return o.text="",a.update(),t}function i(){var e=document.documentElement.scrollTop||document.body.scrollTop,a=r(s.canvas),o=s.canvas.offsetHeight,i=w.offsetHeight,c=a+o+70+i;e>.9*a&&c>e?g||(t(v),g=!0):g&&(n(v),g=!1)}function r(e){for(var t=0;e;)t+=e.offsetTop,e=e.offsetParent;return t}var l=Math,d=Math.random,s=new c.Stage("content-us"),u=document.querySelector("#map-title"),h=u.clientWidth,f=u.offsetHeight,g=!1,m=["#B2949D","#FFF578","#FF5F8D","#37A9CC","#188EB2"];s.canvas.width=h,s.canvas.height=f,c.Ticker.setFPS(60),c.Ticker.addEventListener("tick",function(){s.update()});var v=o();e(v);var w=document.getElementById("map");window.addEventListener("scroll",i),document.addEventListener("resize",function(){u=document.querySelector("#map"),h=window.innerWidth,f=u.clientHeight,s.canvas.width=.56*h,s.canvas.height=f})};