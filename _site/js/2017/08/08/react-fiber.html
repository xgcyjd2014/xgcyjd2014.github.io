                        <!-- 
                            信管创业基地 post.html
                            Design And Build By 倪云港
                            Email: yungangni@gmail.com
                            Github: http://github.com/niyungang
                         -->
<!-- 文章内容 -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
							<!--
							信管创业基地 head-post.html
							Design And Build By 倪云港
							Email: yungangni@gmail.com
							Github: http://github.com/niyungang
						 -->

<!--
	文章内容head
 -->
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="React V16 给我们带来了那些东西 ？-2018信管创业基地-愿景:用心铸造 卓越Offer" />
<meta name="keywords" content="React V16 给我们带来了那些东西 ？,信管创业基地,ImWeb,哈尔滨,黑龙江大学,前端技术,后端技术,jekyll,html5,css3,github,node.js,vue.js,java,技术交流,Sublime3 Text,CreateJs,Ajax" />

<title>Web开发 | 2018信管创业基地官方博客 | 愿景:用心铸造卓越offer </title>

<!-- <link rel="stylesheet" type="text/css" href="/assets/css/main.min.css"> -->
<link rel="stylesheet" type="text/css" href="/assets/css/main.css">
<link rel="stylesheet" type="text/css" href="/assets/css/post.css">
<link rel="stylesheet" type="text/css" href="/assets/css/rouge.min.css">

</head>

<body>
    <!-- Post Header -->
    <a class="post-logo" href="/index.html">
        <img src="/assets/img/logo.png" alt="logo">
        <div class="logo-name liuguang">信管创业基地</div>
    </a>

	<header class="post-header">
		<img id="post-img" class="post-img">
		<section class="post-title">
			<h1 class="article-title">
				React V16 给我们带来了那些东西 ？
			</h1>
			<section class="article-category">
				js
			</section>
	        <section class="article-info">
	        	Posted by Owen on August 8, 2017
	        </section>
		</section>
	</header>

    <!-- Post Box -->
    <section class="post-box">
        <article class="post-body">
            <h2 id="download">download</h2>

<p>我们可以在这里下载到最新的 beta 版react <a href="https://github.com/facebook/react/releases/tag/16.0.0-beta.5">下载链接</a></p>

<h2 id="react-内核改变-fiber">React 内核改变 –fiber</h2>

<p>什么是react-fiber ?</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">increase</span> <span class="nx">its</span> <span class="nx">suitability</span> <span class="k">for</span> <span class="nx">areas</span> <span class="nx">like</span> <span class="nx">animation</span><span class="p">,</span> <span class="nx">layout</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">gestures</span><span class="p">.</span>
<span class="nx">Its</span> <span class="nx">headline</span> <span class="nx">feature</span> <span class="nx">is</span> <span class="nx">incremental</span> <span class="nx">rendering</span><span class="p">:</span> 
<span class="nx">the</span> <span class="nx">ability</span> <span class="nx">to</span> <span class="nx">split</span> <span class="nx">rendering</span> <span class="nx">work</span> <span class="nx">into</span> <span class="nx">chunks</span> <span class="nx">and</span> <span class="nx">spread</span> <span class="nx">it</span> <span class="nx">out</span> <span class="nx">over</span> <span class="nx">multiple</span> <span class="nx">frames</span><span class="p">.</span>
</code></pre></div></div>

<p>react-fiber 是为了增强动画、布局、移动端手势领域的适用性，最重要的特性是对页面渲染的优化: 允许将渲染方面的工作拆分为多段进行</p>

<p>其中fiber 英文意思是纤维，众所周知，Js 是单线程的，当Js 在执行一段代码功能的过程中会对其他的代码进行堵塞</p>

<p>在如今越来越复杂的前端环境下，往往可能需要加载且渲染大量的DOM节点，那么在渲染的过程中，即使我们使用了React virtualDom 进行维护，但是，也是会阻塞其他功能的进行。例如，当其他节点渲染的过程中，用户执行了某些交互操作，例如点击，输入，手势等， 由于在渲染的过程中会阻塞线程，导致 这些交互行为延迟，也就是在用户眼中的卡顿。</p>

<p>Ok， 在这样的使用背景下，Facebook 团队在两年前就开始为我们研究，并且提供了 react-fiber 的新功能，react-fiber 可以为我们提供如下几个功能：</p>

<ol>
  <li>设置渲染任务的优先</li>
  <li>采用新的Diff算法</li>
  <li>采用虚拟栈设计允许当优先级更高的渲染任务和较低优先的任务之间来回切换</li>
</ol>

<p>facebook 团队计划于 react v16 发布 react-fiber</p>

<p>目前已经发布了 beta 版本</p>

<p>详细介绍可以看 <a href="https://www.youtube.com/watch?v=aV1271hd9ew">介绍视频</a></p>

<h3 id="demo">Demo</h3>

<p>首先，我们可以先看一个栗子 <a href="https://claudiopro.github.io/react-fiber-vs-stack-demo/">使用 react-fiber 渲染谢 尔宾斯基三角形 demo</a></p>

<p>很明显可以看出，在大数量节点渲染的情况下，使用原来正常的react方式所渲染的页面要顺畅很多</p>

<h3 id="使用">使用</h3>

<p>让我们来尝试一下 React-fiber 的使用</p>

<p>对比正常的react，fiber做了一次升级</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 首先引用改变了</span>
<span class="k">import</span> <span class="nx">ReactDOMFiber</span> <span class="k">from</span> <span class="s1">'react-dom-fiber'</span><span class="p">;</span>
<span class="nx">ReactDOMFiber</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 由于是beta版，所以渲染的时候，react团队采用了这种方式</span>
<span class="c1">// 以回调的形式进行</span>
<span class="c1">// 从deferredUpdates我们可以看出，这是渲染低优先级的函数</span>

<span class="nx">ReactDOMFiber</span><span class="p">.</span><span class="nx">unstable_deferredUpdates</span><span class="p">(()</span> <span class="o">=&gt;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 我们可以通过回参取得旧state</span>
    <span class="c1">// 更新组件之前的逻辑处理</span>
    <span class="c1">// return新的state</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="c1">// new state  </span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">);</span>
</code></pre></div></div>

<p>在刚刚的例子中</p>

<p>高优先级的渲染任务为父节点的transform动画
低优先级的渲染任务为每一个节点的数据渲染</p>

<h2 id="v16的其他功能">V16的其他功能</h2>

<p>同时 v16 还提供了其他新功能</p>

<h4 id="允许render-函数-处理多纬渲染">允许render 函数 处理多纬渲染</h4>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">ManagePost</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">posts</span>

    <span class="kd">var</span> <span class="nx">something</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">somethingelse</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">posts</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">post</span><span class="p">){</span>
      <span class="k">return</span><span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"col-md-8"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"cold-md-4"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="p">)</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">{</span><span class="nx">row</span><span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>

<span class="p">});</span>
</code></pre></div></div>
<p>可以看出，我们希望能够以一个数组的形式渲染多个节点</p>

<h4 id="渲染异常的降级错误处理">渲染异常的降级错误处理</h4>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">MyGoodView</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
<span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="k">return</span> <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Cool</span><span class="o">&lt;</span><span class="sr">/p&gt;</span><span class="err">;
</span><span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">MyBadView</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
<span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'crap'</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">});</span>

<span class="k">try</span> <span class="p">{</span>
<span class="c1">// 希望抛出错误</span>
<span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">MyBadView</span><span class="o">/&gt;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// 进行错误降级处理</span>
<span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">MyGoodView</span><span class="o">/&gt;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>在之前，如上代码是无法执行到降级处理的，而在 V16中会允许降级处理，并且为我们提供完整可读的组件堆栈异常信息，这样我们就可以对渲染异常的错误进行捕获监控</p>

<h4 id="重写服务器渲染api方法提供多个以流的渲染方法">重写服务器渲染API方法，提供多个以流的渲染方法</h4>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ReactDOMServer</span><span class="p">.</span><span class="nx">renderToStream</span><span class="p">()</span>
<span class="nx">ReactDOMServer</span><span class="p">.</span><span class="nx">renderToStaticStream</span><span class="p">()</span>
</code></pre></div></div>

<p>直出同学的福音</p>

<h4 id="有关-state-函数">有关 state 函数</h4>
<ul>
  <li>对于 state对象返回为 Null 的情况下不会触发重新渲染</li>
  <li>setState 的回调函数 会在所有组件渲染完成之前触发（即componentDidMount / componentWillUnmount） 两个钩子之前</li>
</ul>

<h2 id="需要注意的问题">需要注意的问题</h2>

<p>V16 已经依赖 Es6 Map 和 Set 类型，如果需要支持老旧浏览器场景（ie &lt; 11） 需要在场景内引入垫片库（polyfill）</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 引入 es6 垫片库</span>
<span class="k">import</span> <span class="s1">'core-js/es6/map'</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">'core-js/es6/set'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">'react-dom'</span><span class="p">;</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="nx">world</span><span class="o">!&lt;</span><span class="sr">/h1&gt;</span><span class="err">,
</span>  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>V16 还依赖 requestAnimationFrame 这一API， 如果老旧浏览器不支持，可以使用setTimeout 替代</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">global</span><span class="p">.</span><span class="nx">requestAnimationFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>


            <!-- 上下篇 -->
            <div class="pager">
                
                <a class="previous" href="/js/2017/07/20/how-usr-protobuf.html" data-toggle="tooltip" data-placement="top" title="安利贴：如何使用protobuf">
                上一篇<br>
                <span>安利贴：如何使用protobuf</span>
                </a>
                
                
                <a class="next" href="/other/2017/08/09/.pubmed-or-work.html" data-toggle="tooltip" data-placement="top" title="考研 or 工作？ 致每一个迷茫中的大学生">
                下一篇<br>
                <span>考研 or 工作？ 致每一个迷茫中的大学生</span>
                </a>
                
            </div>

            <!-- 分享 -->
            <ul class="share">
                <li>
                    <span>分享到:</span>
                </li>
                <li>
                    <a class="qzone" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://xgcyjd2014.github.io/js/2017/08/08/react-fiber.html&title=《React V16 给我们带来了那些东西 ？》 作者：Owen 发布日期：2017-08-08 00:00:00 +0800&desc=&pics=http://xgcyjd2014.github.io/assets/img/share-logo.png&site=http://xgcyjd2014.github.io" target="__blank" title="分享到QQ空间"></a>
                </li>
                <li class="ml">
                    <a class="weibo" href="http://service.weibo.com/share/share.php?url=http://xgcyjd2014.github.io/js/2017/08/08/react-fiber.html&title=《React V16 给我们带来了那些东西 ？》 作者：Owen 发布日期：2017-08-08 00:00:00 +0800  &pic=http://xgcyjd2014.github.io/assets/img/share-logo.png&site=http://xgcyjd2014.github.io" target="__blank" title="分享到微博"></a>
                </li>
                <li class="ml">
                    <a class="twitter" href="https://twitter.com/intent/tweet?url=http://xgcyjd2014.github.io/js/2017/08/08/react-fiber.html&text=《React V16 给我们带来了那些东西 ？》 作者：Owen 发布日期：2017-08-08 00:00:00 +0800  " target="__blank" title="分享到推特"></a>
                </li>
                <li class="ml">
                    <a class="qq" href="http://connect.qq.com/widget/shareqq/index.html?url=http://xgcyjd2014.github.io/js/2017/08/08/react-fiber.html&pics=http://xgcyjd2014.github.io/assets/img/share-logo.png&title=《React V16 给我们带来了那些东西 ？》 作者：Owen 发布日期：2017-08-08 00:00:00 +0800&summary=" target="__blank" title="分享到推特"></a>
                </li>
            </ul>

            <div class="youyan">
                <!-- UY BEGIN -->
<!-- <div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2129068"></script> -->
<!-- UY END -->

<!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC8zMDQxMi82OTY2">
	<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
	</script>
<noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->
            </div>
        </article>

        <!-- 书签目录 -->
        <section class="catalog">
            <div class="catalog-title">- CATALOG -</div>
            <div class="catalog-box">
                <ul class="catalog-list"></ul>
            </div>
        </section>

    </section>

	<footer>
								<!--
							信管创业基地 footer.html
							Design And Build By 倪云港
							Email: yungangni@gmail.com
							Github: http://github.com/niyungang
						 -->

<footer class="footer">
	<div class="footer-top">
		<ul class="ul1">
			<p>
				网站相关
			</p>
			<li>
				<a href="/pages/about.html">关于我们</a>
			</li>
			<li>
				<a href="/pages/join.html">加入我们</a>
			</li>
			<li>
				<a href="https://github.com/xgcyjd2014/xgcyjd2014.github.io">关于本站</a>
			</li>
		</ul>

		<ul>
			<p>
				友情链接
			</p>
			<li>
				<a href="http://www.hlju.edu.cn/">黑龙江大学</a>
			</li>
			<li>
				<a href="http://xyw.hlju.edu.cn/">校园信息门户</a>
			</li>
			<li>
				<a href="http://my.hlju.edu.cn/">校园应用门户</a>
			</li>
		</ul>


		<ul class="footer-xk">
			<p>
				内容许可
			</p>
			<li>
				除特别说明外，用户内容均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a> 进行许可
			</li>
		</ul>

		<ul class="footer-img">
		</ul>

	</div>

	<div class="copyright">
		<p>
			<span>
				Copyright © 2002-2018
				<a href="http://www.xgcyjd.com">黑龙江大学信管创业基地</a>
			</span>
			<span>
				网站作者: <a href="https://niyungang.github.io/">倪云港</a>
			</span>
			<span>
				维护支持: <a href="http://www.xgcyjd.com">信管创业基地</a> & <a href="https://hi-craft.github.io/">庞云龙</a>
			</span>
			<span>
				当前呈现版本: V1.4
			</span>
		</p>
	</div>

</footer>



<footer class="footer-mob">
	<p>
		Copyright © 2002-2018 <a href="http://www.xgcyjd.com">黑龙江大学信管创业基地</a>
	</p>
	<p>
		除特别说明外，用户内容均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a> 进行许可
	</p>
	<p>
		维护支持: <a href="http://www.xgcyjd.com">信管创业基地</a> & <a href="https://hi-craft.github.io/">庞云龙</a>
	</p>
	<p>
		网站作者: <a href="https://niyungang.github.io/">倪云港</a>
	</p>
	<p>
		当前呈现版本: V1.4
	</p>
</footer>
	</footer>
</body>
    						<!-- 
							信管创业基地 script-post.html
							Design And Build By 倪云港
							Email: yungangni@gmail.com
							Github: http://github.com/niyungang
						 -->
						 
<!-- 
	文章主体
 -->

<!-- 文章内容 -->

<script src="/assets/js/jquery-3.1.1.min.js"></script>
<script src="/assets/js/post.js"></script>
<script src="/assets/js/main.js"></script>
</html>
