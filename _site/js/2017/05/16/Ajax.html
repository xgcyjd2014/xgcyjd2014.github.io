                        <!-- 
                            信管创业基地 post.html
                            Design And Build By 倪云港
                            Email: yungangni@gmail.com
                            Github: http://github.com/niyungang
                         -->
<!-- 文章内容 -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
							<!-- 
							信管创业基地 head-post.html
							Design And Build By 倪云港
							Email: yungangni@gmail.com
							Github: http://github.com/niyungang
						 -->
						 
<!-- 
	文章内容head
 -->
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="AJAX与数据传输-2015信管创业基地-愿景:用心铸造 卓越Offer" />
<meta name="keywords" content="AJAX与数据传输,信管创业基地,ImWeb,哈尔滨,黑龙江大学,前端技术,后端技术,jekyll,html5,css3,github,node.js,veu.js,java,技术交流,Sublime3 Text,CreateJs,Ajax" />

<title>Web开发 | 2015信管创业基地官方博客 | 愿景:用心铸造卓越offer </title>

<link rel="stylesheet" type="text/css" href="/assets/css/main.css">
<link rel="stylesheet" type="text/css" href="/assets/css/post.css">
<link rel="stylesheet" type="text/css" href="/assets/css/rouge.min.css">

</head>

<body>
    <!-- Post Header -->
    <a class="post-logo" href="/index.html">
        <img src="/assets/img/logo.png" alt="logo">
        <div class="logo-name liuguang">信管创业基地</div>
    </a>

	<header class="post-header">
		<img id="post-img" class="post-img">
		<section class="post-title">
			<h1 class="article-title">
				AJAX与数据传输
			</h1>
			<section class="article-category">
				js
			</section>
	        <section class="article-info">
	        	Posted by 倪云港 on May 16, 2017
	        </section>
		</section>
	</header>

    <!-- Post Box -->
    <section class="post-box">
        <article class="post-body">
            <h2 id="何谓ajax">何谓AJAX</h2>

<h3 id="简介">简介</h3>

<p>AJAX即 “Asynchronous Javascript And XML”（异步的JavaScript和XML），是指一种创建交互式网页应用的网页开发技术。</p>

<p>英文名：艾杰克斯（拼音读法）</p>

<p>中文名：阿贾克斯</p>

<p>通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p>

<p>实现节省用户操作时间，提高用户体验，减少数据请求，传输获取/修改数据的效果</p>

<h3 id="优点">优点：</h3>

<p>页面无刷新，用户体验好。</p>

<p>异步通信，更加快的响应能力。</p>

<p>减少冗余请求，减轻了服务器负担</p>

<p>基于标准化的并被广泛支持的技术，不需要下载插件或者小程序</p>

<h3 id="缺点">缺点：</h3>

<p>ajax干掉了back按钮，即对浏览器后退机制的破坏。</p>

<p>存在一定的安全问题。</p>

<p>对搜索引擎的支持比较弱。</p>

<p>破坏了程序的异常机制。</p>

<p>无法用URL直接访问</p>

<h3 id="ajax应用场景">ajax应用场景</h3>

<p>场景 1. 数据验证</p>

<p>场景 2. 按需取数据</p>

<p>场景 3. 自动更新页面</p>

<h3 id="ajax包含以下五个部分">AJAX包含以下五个部分:</h3>

<p>ajax并非一种新的技术，而是几种原有技术的结合体。它由下列技术组合而成。</p>

<ol>
  <li>
    <p>使用CSS和XHTML来表示。</p>
  </li>
  <li>
    <p>使用DOM模型来交互和动态显示。</p>
  </li>
  <li>
    <p>数据互换和操作技术，使用XML与XSLT</p>
  </li>
  <li>
    <p>使用XMLHttpRequest来和服务器进行异步通信。</p>
  </li>
  <li>
    <p>使用javascript来绑定和调用。</p>
  </li>
</ol>

<h2 id="ajax的处理过程">AJAX的处理过程</h2>

<p>首先需要说明一点的是ajax是异步通信的，客户端向服务器请求一条数据后就不管了，继续执行下面的代码。</p>

<p>接着是服务器，服务器那边接收到请求后就开始处理客户端的请求，处理完毕后再将数据发给客户端。然后客户端这时才继续执行相应的函数。</p>

<p>利用异步通信这一点，我们可以实现不用刷新页面就实现页面更新。</p>

<h2 id="最基础的ajax">最基础的AJAX</h2>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">//可以想象成虚拟的打开了一个输入Url的地址框</span>
<span class="k">try</span><span class="p">{</span>
	<span class="c1">//IE7以上创建AJAX对象</span>
	<span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
	<span class="c1">//兼容IE6 以ActiveXObject插件的形式创建AJAX对象</span>
	<span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s1">'Microsoft.XMLHTTP'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//可以想象成向这个虚拟的地址框里输入要访问文件的地址</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'get'</span><span class="p">,</span><span class="s1">'地址'</span><span class="p">,</span><span class="s1">'true &amp; false'</span><span class="p">);</span>
<span class="c1">//传输的方式 有get &amp; post 两种</span>
<span class="c1">//true为异步，false为同步</span>

<span class="c1">//可以想象成回车发送请求</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">//服务器接收处理请求，然后返回数据</span>
<span class="c1">//服务器的readystate 是会 change 的,每变一次就触发一次函数。</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">//如果HTTP状态码 等于 200(请求成功) 那么就弹出返回的文件内容</span>
		<span class="c1">//xhr.responseText为服务器返回的数据</span>
		<span class="k">if</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">){</span>
			<span class="nx">alert</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span> <span class="p">);</span>
		<span class="p">}</span><span class="k">else</span><span class="p">{</span>
			<span class="nx">alert</span><span class="p">(</span> <span class="s1">'出错了 ，Err : '</span> <span class="o">+</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre>
</div>

<p>如果需要用POST上传数据,则需要添加HTTP头声明</p>

<p>然后，在send()中规定你所需要发送的数据</p>

<p>也就是说上面的</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'get'</span><span class="p">,</span><span class="s1">'地址'</span><span class="p">,</span><span class="s1">'true &amp; false'</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</code></pre>
</div>
<p>要改成</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"post"</span><span class="p">,</span><span class="s2">"地址"</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">"Content-type"</span><span class="p">,</span><span class="s2">"application/x-www-form-urlencoded"</span><span class="p">);</span><span class="c1">//关键，不能省</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"name=Neo&amp;phone=15590866775"</span><span class="p">);</span>
<span class="c1">//也可以用变量来保存这种格式</span>
</code></pre>
</div>

<h2 id="ajax通信的步骤">ajax通信的步骤：</h2>

<p>Ajax的原理简单来说通过XmlHttpRequest对象来向服务器发异步请求，从服务器获得数据，然后用javascript来操作DOM而更新页面。这其中最关键的一步就是从服务器获得请求数据。原生创建ajax可分为以下四步：</p>

<h2 id="1创建-xmlhttprequest-对象">1、创建 XMLHttpRequest 对象。</h2>

<p>Ajax的核心是XMLHttpRequest对象，它是Ajax实现的关键，发送异步请求、接受响应以及执行回调都是通过它来完成</p>

<p>所有现代浏览器（IE7+、Firefox、Chrome、Safari 以及 Opera）均内建 XMLHttpRequest 对象。</p>

<p>创建 XMLHttpRequest对象的语法：</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
</code></pre>
</div>

<p>老版本的 Internet Explorer（IE5 和 IE6）使用ActiveX 对象：</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s2">"Microsoft.XMLHTTP"</span><span class="p">);</span>
</code></pre>
</div>

<p>为了兼容所有的现代浏览器，包括 IE5 和 IE6，可以检查浏览器是否支持 XMLHttpRequest对象。如果支持，则创建XMLHttpRequest对象。如果不支持，则创建ActiveXObject：</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="k">try</span> <span class="p">{</span>
	<span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s1">'Microsoft.XMLHTTP'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="2open方法-初始化请求">2、open()方法 初始化请求。</h2>

<p>用途：初始化请求，此时并没有发送。</p>

<p>参数1：请求方式，get或者post。</p>

<p>参数2：请求路径，数据被传输的目的地地址。</p>

<p>参数3：true：异步请求。false:同步请求。</p>

<h3 id="get的传输方式分析">get的传输方式分析</h3>

<p>将表单数据以名称/值对的形式附加到 URL 中</p>

<p>URL 的长度是有限的（大约 3000 字符）</p>

<p>不要使用 GET 来发送敏感数据！（在 URL 中是可见的）</p>

<p>GET 更适用于非安全数据，比如在 Google 中查询字符串</p>

<p>通过get的方式请求数据，对于send()方法，参数为null或空就可以。</p>

<h3 id="ajax使用get方式是如何传输数据">ajax使用get方式是如何传输数据</h3>

<p>get方式的参数是放在url里面传输的，所以我们只要把参数放到url后面，拼接url字符串就可以了。</p>

<p>url中的参数传递格式:</p>

<p>url是一个地址，当我们需要传递参数的时候，首先需要在url后添加一个?号，然后后面跟上我们的参数,参数之间以&amp;相连。</p>

<p>比如username=”倪云港”&amp;password=”123456”。</p>

<p>完整的例子如下：</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">http</span><span class="err">:</span><span class="c1">//www.example.com/index.php?username=倪云港&amp;password=123456。</span>
</code></pre>
</div>

<p>get请求中如果有中文可能会报错。所以，一般会对参数用encodeURI()方法重新编码。</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">url</span><span class="o">=</span><span class="s2">"open.php?username="</span><span class="o">+</span><span class="nb">encodeURI</span><span class="p">(</span><span class="nx">username</span><span class="p">)</span><span class="o">+</span><span class="s2">"&amp;password="</span><span class="o">+</span><span class="nx">password</span><span class="p">;</span>

</code></pre>
</div>

<h3 id="post的传输方式分析">post的传输方式分析</h3>

<p>将表单数据附加到 HTTP 请求的 body 内（数据不显示在 URL 中）</p>

<p>没有长度限制</p>

<p>通过 POST 提交的表单不能加入书签</p>

<h3 id="ajax使用post方式是如何传输数据">ajax使用post方式是如何传输数据</h3>

<p>post请求传输数据的时候，数据是作为send方法的参数传输的。</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">param</span> <span class="o">=</span> <span class="s1">'username='</span><span class="o">+</span><span class="nx">username</span><span class="o">+</span><span class="s1">'&amp;password='</span><span class="o">+</span><span class="nx">password</span><span class="p">;</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
</code></pre>
</div>

<p>一般数据接收方，也就是后台对于post请求，会默认其数据类型是表单数据类型，所以需要我们设置一下post请求的数据格式，否则我们提交的数据会因为编码格式不对，导致后台取不到我们提交的数据。</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="err">"</span><span class="nx">application</span><span class="o">/</span><span class="nx">x</span><span class="o">-</span><span class="nx">www</span><span class="o">-</span><span class="nx">form</span><span class="o">-</span><span class="nx">urlencoded</span><span class="p">;);</span>
</code></pre>
</div>

<h2 id="3xhrsend-发送请求">3、xhr.send() 发送请求。</h2>

<p>通过get的方式请求数据，对于send()方法，参数为null或空就可以。</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'get'</span><span class="p">,</span><span class="s1">'地址'</span><span class="p">,</span><span class="s1">'true &amp; false'</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</code></pre>
</div>

<p>通过post的方式修改数据，需使用 setRequestHeader()来添加 HTTP 头。然后在send()方法中规定希望发送的数据：</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"post"</span><span class="p">,</span><span class="s2">"地址"</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">"Content-type"</span><span class="p">,</span><span class="s2">"application/x-www-form-urlencoded"</span><span class="p">);</span><span class="c1">//关键，不能省</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"name=Neo&amp;phone=15590866775"</span><span class="p">);</span>
</code></pre>
</div>

<h2 id="4处理响应">4、处理响应</h2>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="readystate">readyState</h3>

<p>readyState只有5个值{0，1，2，3，4}，只读不能写。</p>

<p>0：XMLHttpRequest对象创建完成。</p>

<p>1：XMLHttpRequest对象初始化完成。</p>

<p>2：请求已经发送。</p>

<p>3：服务器已经返回了数据（但是还没有被解析，可能只一段http报文）。</p>

<p>4：数据解析已经完成。</p>

<h3 id="status">status</h3>

<p>status状态码，来自于http协议。详细的状态码以及意义可以参考http协议。</p>

<p>比较常见的：</p>

<p>200：成功</p>

<p>404：页面不存在</p>

<p>503：页面存在，但有语法错误</p>

<h3 id="responsetext和responsexml">ResponseText和ResponseXml</h3>

<p>数据返回的格式。</p>

<p>ResponseText表示返回的是一个字符串，也就是一个JSON。对象，和localstroge有点像。不管文件内容是什么都直接返回字符串。</p>

<p>ResponseXml表示返回的是一个xml格式的文档，如果返回的数据中有不符合xml格式的，则不会返回。比如文档内容如下：</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">book</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;</span><span class="err">红楼梦</span><span class="o">&lt;</span><span class="sr">/name</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">category</span><span class="o">&gt;</span><span class="err">文学</span><span class="o">&lt;</span><span class="sr">/category</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">desc</span><span class="o">&gt;</span><span class="err">宝哥哥与林妹妹的爱情史</span><span class="o">&lt;</span><span class="sr">/desc</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/book&gt;   </span><span class="err"> 
</span><span class="nx">helloworld</span>
</code></pre>
</div>

<p>helloworld没有被标签闭合，不符合xml格式。</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">data1</span><span class="o">=</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseXML</span><span class="p">;</span>
</code></pre>
</div>
<p>打印data1会发现结果中并没有helloworld，因为它不符合xml格式，所以不会被传输过来。</p>

<h2 id="jquery中的ajax">jquery中的ajax</h2>

<p>会发现每次发送请求，都要写上这么一段代码：</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">xhr</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span>
<span class="nx">xhr</span><span class="o">=</span><span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"get"</span><span class="p">,</span><span class="nx">url</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="o">=</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span><span class="o">===</span><span class="mi">4</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="o">===</span><span class="mi">200</span><span class="p">){</span>
            <span class="nx">dosomething</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>其中大部分的代码都一样，所以我们完全可以抽象成一个方法。</p>

<p>jquery方法帮我们封装好了一系列的ajax方法，我们只要直接调用就可以了。
使用jquery发送ajax请求的话，只要一行代码就可以了。</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
	<span class="na">url</span><span class="p">:</span><span class="s2">"test.js"</span><span class="p">,</span>
	<span class="na">dataType</span><span class="p">:</span><span class="s2">"json"</span>
<span class="p">});</span>
</code></pre>
</div>

<h2 id="jsonp">jsonp</h2>

<p>在讲jsonp是什么之前，我们先看下这么一个情况，我们想写一个天气预报的实时页面，数据肯定是从其他网站来的，比如url:”http://m.weather.com.cn/data/101110101.html”这个接口就提供了我们需要的天气数据。所以我们只需要使用ajax发送请求到这个网站上，再接收天气数据在页面上渲染就可以了。</p>

<p>但是当我们写好代码运行的时候会报错，提示No ‘Access-Control-Allow-Origin’ header is present on the requested resource. Origin ‘http://localhost:63342’ is therefore not allowed access.</p>

<p>大概意思是无法接收请求，原因是发生了跨域，也就是我们访问了其他域名，出于安全原因，我们不会接收其他域名发送过来的文件数据。对于这个跨域问题，有不同的解决方案，我们使用的方案是jsonp。</p>

<p>jsonp到底是什么？不要着急，继续往下看。</p>

<p>虽然浏览器不让我们接收其他网站的数据，但是允许我们加载其他网站上的script文件。比如说常见的在线引用jquery：</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"https://cdn.bootcss.com/jquery/3.2.1/jquery.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre>
</div>

<p>所以我们完全可以通过script的方式来加载数据:</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"https://cdn.example.com/提供数据源.php"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span></code></pre>
</div>
<p>假设这个 提供数据源.php 的内容如下：</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">echo</span> <span class="s2">"helloworld"</span><span class="p">;</span>  <span class="c1">//输出helloworld</span>
</code></pre>
</div>

<p>那么页面中的</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"https://cdn.bootcss.com/提供数据源.php"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre>
</div>
<p>加载完后会返回helloworld。</p>

<p>通过这样的方式，我们成功的获取了其他网站上的数据。</p>

<p>现在回到jsonp是什么这个问题上，jsonp就是值通过加载script文件这种方式解决跨域问题的一种方案（有问题，不过暂时这么理解）。但是实际上jsonp比上面这个例子稍微复杂一点。首先我们看一下html文件：</p>
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>jsonp<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="kd">function</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"https://cdn.example.com/提供数据源.php?_jsonp=cb"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>
<p>在主体下面我们引入了一个 提供数据源.php 文件，这个php文件内容如下：</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="p">?</span><span class="nx">php</span> 
<span class="nx">$callback</span> <span class="o">=</span> <span class="nx">$_GET</span><span class="p">[</span><span class="s1">'_jsonp'</span><span class="p">];</span>
<span class="nx">$arr</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s2">"数据一"</span><span class="p">,</span><span class="s2">"数据二"</span><span class="p">,</span><span class="s2">"数据三"</span><span class="p">);</span>
<span class="nx">echo</span> <span class="nx">$callback</span><span class="p">.</span><span class="s2">"("</span><span class="p">.</span><span class="nx">json_encode</span><span class="p">(</span><span class="nx">$arr</span><span class="p">).</span><span class="s2">")"</span><span class="p">;</span>

 <span class="p">?</span><span class="o">&gt;</span>
</code></pre>
</div>
<p>大概意思是获取url传过来的参数_jsonp的值并赋值给callback，然后再拼接字符串，拼成callback(arr)。然后再将拼好的字符串加载到页面上。</p>

<p>这一段绕来绕去做了个什么？其实就是将传回来的数据放到之前定义好的函数中执行。因为后台的获取这个函数名是根据url传过来的参数取出来的，所以这个参数名_jsonp最好统一，方便后台程序员编写接口。</p>

<p>到这里，我们再看下jsonp的定义与背景：</p>

<p>1、一个众所周知的问题，Ajax直接请求普通文件存在跨域无权限访问的问题，甭管你是静态页面、动态网页、web服务、WCF，只要是跨域请求，一律不准；</p>

<p>2、不过我们又发现，Web页面上调用js文件时则不受是否跨域的影响（不仅如此，我们还发现凡是拥有”src”这个属性的标签都拥有跨域的能力，比如&lt; script&gt;、&lt; img&gt;、&lt; iframe&gt;；</p>

<p>3、于是可以判断，当前阶段如果想通过纯web端（ActiveX控件、服务端代理、属于未来的HTML5之Websocket等方式不算）跨域访问数据就只有一种可能，那就是在远程服务器上设法把数据装进js格式的文件里，供客户端调用和进一步处理；</p>

<p>4、恰巧我们已经知道有一种叫做JSON的纯字符数据格式可以简洁的描述复杂数据，更妙的是JSON还被js原生支持，所以在客户端几乎可以随心所欲的处理这种格式的数据；</p>

<p>5、这样子解决方案就呼之欲出了，web客户端通过与调用脚本一模一样的方式，来调用跨域服务器上动态生成的js格式文件（一般以JSON为后缀），显而易见，服务器之所以要动态生成JSON文件，目的就在于把客户端需要的数据装入进去。</p>

<p>6、客户端在对JSON文件调用成功之后，也就获得了自己所需的数据，剩下的就是按照自己需求进行处理和展现了，这种获取远程数据的方式看起来非常像AJAX，但其实并不一样。</p>

<p>7、为了便于客户端使用数据，逐渐形成了一种非正式传输协议，人们把它称作JSONP，该协议的一个要点就是允许用户传递一个callback参数给服务端，然后服务端返回数据时会将这个callback参数作为函数名来包裹住JSON数据，这样客户端就可以随意定制自己的函数来自动处理返回数据了。</p>

<p><a href="http://niyungang.com/%E6%8A%80%E6%9C%AF/2017/05/16/Ajax.html">原文链接</a></p>


            <!-- 上下篇 -->
            <div class="pager">
                
                <a class="previous" href="/js/2017/04/30/JSON.html" data-toggle="tooltip" data-placement="top" title="JSON学习笔记">
                上一篇<br>
                <span>JSON学习笔记</span>
                </a>
                
                
                <a class="next" href="/js/2017/05/18/understand-the-onion-modal.html" data-toggle="tooltip" data-placement="top" title="简单理解洋葱模型">
                下一篇<br>
                <span>简单理解洋葱模型</span>
                </a>
                
            </div>

            <!-- 分享 -->
            <ul class="share">
                <li>
                    <span>分享到:</span>
                </li>
                <li>
                    <a class="qzone" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://xgcyjd2014.github.io/js/2017/05/16/Ajax.html&title=《AJAX与数据传输》 作者：倪云港 发布日期：2017-05-16 00:00:00 +0800&desc=&pics=http://xgcyjd2014.github.io/assets/img/share-logo.png&site=http://xgcyjd2014.github.io" target="__blank" title="分享到QQ空间"></a>
                </li>
                <li class="ml">
                    <a class="weibo" href="http://service.weibo.com/share/share.php?url=http://xgcyjd2014.github.io/js/2017/05/16/Ajax.html&title=《AJAX与数据传输》 作者：倪云港 发布日期：2017-05-16 00:00:00 +0800  &pic=http://xgcyjd2014.github.io/assets/img/share-logo.png&site=http://xgcyjd2014.github.io" target="__blank" title="分享到微博"></a>
                </li>
                <li class="ml">
                    <a class="twitter" href="https://twitter.com/intent/tweet?url=http://xgcyjd2014.github.io/js/2017/05/16/Ajax.html&text=《AJAX与数据传输》 作者：倪云港 发布日期：2017-05-16 00:00:00 +0800  " target="__blank" title="分享到推特"></a>
                </li>
                <li class="ml">
                    <a class="qq" href="http://connect.qq.com/widget/shareqq/index.html?url=http://xgcyjd2014.github.io/js/2017/05/16/Ajax.html&pics=http://xgcyjd2014.github.io/assets/img/share-logo.png&title=《AJAX与数据传输》 作者：倪云港 发布日期：2017-05-16 00:00:00 +0800&summary=" target="__blank" title="分享到推特"></a>
                </li>
            </ul>

            <div class="youyan">
                <!-- UY BEGIN -->
<!-- <div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2129068"></script> -->
<!-- UY END -->

<!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC8zMDQxMi82OTY2">
	<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
	</script>
<noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->
            </div>
        </article>

        <!-- 书签目录 -->
        <section class="catalog">
            <div class="catalog-title">- CATALOG -</div>
            <div class="catalog-box">
                <ul class="catalog-list"></ul>
            </div>
        </section>

    </section>

	<footer>
								<!-- 
							信管创业基地 footer.html
							Design And Build By 倪云港
							Email: yungangni@gmail.com
							Github: http://github.com/niyungang
						 -->
						 
<footer>
	<div class="footer-top">
		<ul class="ul1">
			<p>
				网站相关
			</p>
			<li>
				<a href="">关于我们</a>
			</li>
			<li>
				<a href="">加入我们</a>
			</li>
			<li>
				<a href="">关于本站</a>
			</li>
		</ul>

		<ul>
			<p>
				友情链接
			</p>
			<li>
				<a href="http://www.hlju.edu.cn/">黑龙江大学</a>
			</li>
			<li>
				<a href="http://xyw.hlju.edu.cn/">校园信息门户</a>
			</li>
			<li>
				<a href="http://my.hlju.edu.cn/">校园应用门户</a>
			</li>
		</ul>


		<ul class="footer-xk">
			<p>
				内容许可
			</p>
			<li>
				除特别说明外，用户内容均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a> 进行许可
			</li>
		</ul>

		<ul class="footer-img">
		</ul>

	</div>

	<div class="copyright">
		<p>
			<span>
				Copyright © 2002-2017
				<a href="http://www.xgcyjd.com">黑龙江大学信管创业基地</a>
			</span>
			<span>
				网站作者: <a href="http://www.niyungang.github.io">倪云港</a>
			</span>
			<span>
				维护支持: <a href="http://www.xgcyjd.com">信管创业基地</a> & <a href="http://www.niyungang.github.io">倪云港</a>
			</span>
		</p>
		<p>
			
		</p>
	</div>

</footer>
	</footer>
</body>
    						<!-- 
							信管创业基地 script-post.html
							Design And Build By 倪云港
							Email: yungangni@gmail.com
							Github: http://github.com/niyungang
						 -->
						 
<!-- 
	文章主体
 -->

<!-- 文章内容 -->


<script src="/assets/js/jquery-3.1.1.min.js"></script>
<script src="/assets/js/main.js"></script>
<script type="text/javascript" src="/assets/js/post.js"></script>
</html>
